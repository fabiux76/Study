<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>I concetti - My Studies</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">My Studies</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="navitem">
                                <a href="../../todo/" class="nav-link">Todo</a>
                            </li>
                            <li class="navitem">
                                <a href="../../done/" class="nav-link">Done</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">TypeScript <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../Typescript/typescript/" class="dropdown-item">General</a>
</li>
                                    
<li>
    <a href="../../Typescript/usecases/" class="dropdown-item">UseCases</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Serverless <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../liveproject/" class="dropdown-item">Liveproject</a>
</li>
                                    
<li>
    <a href="../typescript%20template/" class="dropdown-item">Typescript Template</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../../Github/github_actions/" class="nav-link">Github</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#i-concetti" class="nav-link">I concetti</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#userpool" class="nav-link">UserPool</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#userpoolclient" class="nav-link">UserPoolClient</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#identitypool" class="nav-link">IdentityPool</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#possibili-scenari" class="nav-link">Possibili scenari</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#miei-progettini-esempio" class="nav-link">Miei progettini esempio</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#foobar-2018" class="nav-link">Foobar 2018</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#comandi-utili" class="nav-link">Comandi utili</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#creazioen-utente" class="nav-link">Creazioen utente</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#todo" class="nav-link">TODO:</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="i-concetti">I concetti</h1>
<h2 id="userpool">UserPool</h2>
<p>User pools are user directories that provide sign-up and sign-in options for your app users</p>
<p>A user pool is a user directory in Amazon Cognito. Your app users can sign in either directly through a user pool, or federate through a third-party identity provider (IdP). The user pool manages the overhead of handling the tokens that are returned from social sign-in through Facebook, Google, Amazon, and Apple, and from OpenID Connect (OIDC) and SAML IdPs. Whether your users sign in directly or through a third party, all members of the user pool have a directory profile that you can access through an SDK.</p>
<h2 id="userpoolclient">UserPoolClient</h2>
<p>After you create a user pool, you can create an app to use the built-in webpages for signing up and signing in your users.</p>
<h2 id="identitypool">IdentityPool</h2>
<p>Identity pools enable you to grant your users access to other AWS services</p>
<p>With an identity pool, your users can obtain temporary AWS credentials to access AWS services, such as Amazon S3 and DynamoDB. Identity pools support anonymous guest users, as well as federation through third-party IdPs.</p>
<p>Questi hanno tra le proprietà, i <code>CognitoIdentityProviders</code> che possono essere tra gli altri un <code>UserPoolClient</code></p>
<h1 id="possibili-scenari">Possibili scenari</h1>
<p>C'è proprio una pagina AWS <a href="https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-scenarios.html">Common Amazon Cognito scenarios</a> BELLISSIMA! E' Proprio quella che cercavo</p>
<p><strong>This topic describes six common scenarios for using Amazon Cognito.</strong> !!!</p>
<p>Da qui capisco anche il discorso del Amazon Cognito authorizer Lambda function, che secondo me è da usare se nella richiesta c'è il token dello user pool, mentre se si passa dall'identity pool, allora in quel caso nella richiesta ci saranno le credenziali AWS quindi bisogna usare AWS authorizer</p>
<h1 id="miei-progettini-esempio">Miei progettini esempio</h1>
<h2 id="foobar-2018">Foobar 2018</h2>
<p>Rifatto progettino secondo questi due video di foobar:
- <a href="https://github.com/mavi888/sls-cognito-backend">Parte backend</a>
- <a href="https://www.youtube.com/watch?v=-ZrYlsEBLmo&amp;t=0s">Parte frontend</a></p>
<p><a href="https://github.com/fabiux76/sls-cognito-1">Qui</a> il mio repo</p>
<p>Cosa ricordare di questo:</p>
<ul>
<li>L'obiettivo di questo progetto è definire uno UserPool + IdentityPool, più un'endpoint ApiGateway protetto </li>
<li>Parte backend sviluppato con serverless</li>
<li>Le risorsce (cloudformation) definite sono<ul>
<li><code>UserPool</code></li>
<li><code>UserPoolClient</code></li>
<li><code>IdentityPool</code> (che come <code>CognitoIdentityProviders</code> ha il <code>CognitorUserPool</code> + <code>CognitoUserPoolClient</code>)</li>
<li>Ruoli per utenti autenticati e non autenticati + Attach di tali ruoli al <code>IdentityPool</code></li>
</ul>
</li>
<li>Il ruole per gli utenti loggati indica che possono fare la chiamata all'api:
    ```yaml<ul>
<li>Effect: "Allow"
  Action:<ul>
<li>"execute-api:Invoke"
  Resource: "*"
```</li>
</ul>
</li>
</ul>
</li>
<li>Per l'ApiGateway create come evento della lambda vengono specificati questi valori:
    <code>yaml
    functions:
        hello:
            handler: handler.hello
            events:
            - http:
                path: hello
                method: get
                cors: true
                authorizer: aws_iam</code>
    In particolare si specifica che l'<code>authorzer</code> deve essere <code>aws_iam</code></li>
<li>La parte client è fatta in React (quindi è un'app creata con <code>create-react-app</code>) e su questa poi è stato installato il pacakge <code>aws-amplify</code></li>
<li>Per fare andare amplify con la versione del codice illustrata, ho dovuto installare una versione molto vecchia (<code>0.3.3</code>) mentre la latest che sarebbe stata installata (<code>4</code>)</li>
<li>Nell'applicazione client viene fatta questa chiamata fondamentale: 
    <code>javascript
    Amplify.configure({
        Auth: {
            mandatorySignIn: true,
            region: config.cognito.REGION,
            userPoolId: config.cognito.USER_POOL_ID,
            identityPoolId: config.cognito.IDENTITY_POOL_ID,
            userPoolWebClientId: config.cognito.APP_CLIENT_ID
        },
        API: {
            endpoints: [
                {
                    name: 'testApiCall',
                    endpoint: config.apiGateway.URL,
                    region: config.apiGateway.REGION
                }
            ]
        }
    });</code></li>
<li>Dopo aver configurato questi parametri poi è possibile usare la libreria amplify per fare cose come:<ul>
<li><code>javascript
  await Auth.signIn(this.state.email, this.state.password);</code></li>
<li><code>javascript
  const newUser = await Auth.signUp({
    username: this.state.email,
    password: this.state.password
  });</code></li>
<li><code>javascript
  await Auth.confirmSignUp(this.state.email, this.state.confirmationCode);</code>   </li>
<li><code>javascript
  API.get('testApiCall', '/hello');</code></li>
</ul>
</li>
</ul>
<p>Tutte le chiamate relative ad Auth usano evidentemente la configurazione settata prima.
Per quanto riguarla la chiamata all'API, evidentemente si intende debba essere autenticata con la modalità specificata, in questo caso con il token AWS ottenuto dell'identityPool viene inserito negli header della richiesta</p>
<h3 id="cose-che-non-mi-sono-chiare-di-questo-progetto">Cose che non mi sono chiare di questo progetto</h3>
<ul>
<li>Nella definizione dell'<code>IdentityPool</code>, specifichiamo questa proprietà: <code>AllowUnauthenticatedIdentities: false</code>, però poi definiamo anche i ruoli per gli utenti non autenticati... Capire bene i collegamenti</li>
</ul>
<h1 id="comandi-utili">Comandi utili</h1>
<h2 id="creazioen-utente">Creazioen utente</h2>
<pre><code>λ aws cognito-idp sign-up --region us-east-1 --client-id 5i9htq9ejfe2d9qkhk2ec9ohkt --username admin@example.com --password Passw0rd!
</code></pre>
<p>Output:</p>
<pre><code>{                                                                                                                                   
    &quot;UserConfirmed&quot;: false,                                                                                                          
    &quot;UserSub&quot;: &quot;7444c0c9-5ec1-43ba-a011-37f12c5a8d3c&quot;                                                                                
}                                                                                      
</code></pre>
<p>L'utente va poi confermato da console</p>
<p><img alt="" src="../2022-04-07-15-35-44.png" /></p>
<h1 id="todo">TODO:</h1>
<ul>
<li>Collegare google\facebook</li>
<li>Discorse dell'AWS autenticator per api gateway... come si intreccia? 
    Secondo m</li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
